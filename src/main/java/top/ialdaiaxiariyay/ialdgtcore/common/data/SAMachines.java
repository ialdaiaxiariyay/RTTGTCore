package top.ialdaiaxiariyay.ialdgtcore.common.data;

import com.gregtechceu.gtceu.GTCEu;
import com.gregtechceu.gtceu.api.GTCEuAPI;
import com.gregtechceu.gtceu.api.GTValues;
import com.gregtechceu.gtceu.api.data.RotationState;
import com.gregtechceu.gtceu.api.machine.MachineDefinition;
import com.gregtechceu.gtceu.api.machine.multiblock.PartAbility;
import com.gregtechceu.gtceu.api.machine.multiblock.WorkableElectricMultiblockMachine;
import com.gregtechceu.gtceu.api.pattern.FactoryBlockPattern;
import com.gregtechceu.gtceu.api.pattern.Predicates;
import com.gregtechceu.gtceu.api.recipe.GTRecipe;
import com.gregtechceu.gtceu.api.recipe.OverclockingLogic;
import com.gregtechceu.gtceu.common.data.GCyMRecipeTypes;
import com.gregtechceu.gtceu.common.data.GTRecipeModifiers;
import com.gregtechceu.gtceu.common.data.GTRecipeTypes;
import com.lowdragmc.lowdraglib.side.fluid.FluidHelper;
import it.unimi.dsi.fastutil.ints.Int2LongFunction;
import net.minecraft.network.chat.Component;
import net.minecraft.world.level.block.Block;
import top.ialdaiaxiariyay.ialdgtcore.api.registries.SARegistries;
import top.ialdaiaxiariyay.ialdgtcore.data.CreativeModeTabs;
import top.ialdaiaxiariyay.ialdgtcore.ialdgtcore;

import java.util.function.Supplier;

import static com.gregtechceu.gtceu.api.GTValues.*;
import static com.gregtechceu.gtceu.api.pattern.Predicates.blocks;
import static com.gregtechceu.gtceu.common.data.GCyMBlocks.*;
import static com.gregtechceu.gtceu.common.data.GTBlocks.*;
import static com.gregtechceu.gtceu.common.data.GTRecipeModifiers.*;
import static top.ialdaiaxiariyay.ialdgtcore.api.registries.SARegistries.*;

@SuppressWarnings({"Convert2MethodRef", "FunctionalExpressionCanBeFolded", "unused", "DataFlowIssue"})
public class SAMachines {
    static {
        SARegistries.REGISTRATE.creativeModeTab(() -> CreativeModeTabs.ITEM);
    }
    public static void init() {}
    public final static int[] ELECTRIC_TIERS = GTValues.tiersBetween(LV, GTCEuAPI.isHighTier() ? OpV : UV);
    public final static int[] LOW_TIERS = GTValues.tiersBetween(LV, EV);
    public final static int[] HIGH_TIERS = GTValues.tiersBetween(IV, GTCEuAPI.isHighTier() ? OpV : UHV);
    public static final Int2LongFunction defaultTankSizeFunction = tier -> (tier <= GTValues.LV ? 8 : tier == GTValues.MV ? 12 : tier == GTValues.HV ? 16 : tier == GTValues.EV ? 32 : 64) * FluidHelper.getBucket();

    public static final MachineDefinition LARGE_SHAPE_WORLD_VOID_PUMP = REGISTRATE.multiblock("large_shape_world_void_pump",  WorkableElectricMultiblockMachine::new)
            .rotationState(RotationState.NON_Y_AXIS)
            .appearanceBlock(CASING_BRONZE_BRICKS)
            .recipeType(SARecipes.LARGE_SHAPE_WORLD_VOID_PUMP)
            .recipeModifiers(GTRecipeModifiers.PARALLEL_HATCH, GTRecipeModifiers.ELECTRIC_OVERCLOCK.apply(OverclockingLogic.PERFECT_OVERCLOCK_SUBTICK))
            .pattern(definition -> FactoryBlockPattern.start()
                    .aisle("           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ")
                    .aisle("           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ")
                    .aisle("                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ")
                    .aisle("                      ", "                      ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "         CCCCC        ", "           C          ", "         DDDDD        ", "         DDDDD        ", "         DDDDD        ", "         DDDDD        ", "                      ")
                    .aisle("                      ", "                      ", "                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "                      ", "                      ", "           C          ", "                      ", "                      ", "           C          ", "                      ", "                      ", "         CCCCC        ", "                      ", "         DDDDD        ", "       CCDDDDDCC      ", "         DDDDD        ", "       DD     DD      ", "       DD     DD      ", "       DD     DD      ", "       DD     DD      ", "         DDDDD        ")
                    .aisle("                      ", "                      ", "                      ", "                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "                      ", "                      ", "           C          ", "                      ", "                      ", "         CCCCC        ", "                      ", "         DDDDD        ", "       CCDDDDDCC      ", "         DDDDD        ", "       DD     DD      ", "      CDDEEEEEDDC     ", "       DD     DD      ", "      D         D     ", "      D         D     ", "      D         D     ", "      DEEEEEEEEED     ", "       DDDDDDDDD      ")
                    .aisle("                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "                      ", "                      ", "          CCC         ", "                      ", "         DDDDD        ", "        CDDDDDC       ", "         DDDDD        ", "       DD     DD      ", "      CDDEEEEEDDC     ", "       DD     DD      ", "      D         D     ", "     CDEE  E  EEDC    ", "      D         D     ", "     D           D    ", "     D           D    ", "     D           D    ", "     DE    E    ED    ", "      DDDDDDDDDDD     ")
                    .aisle("                      ", "                      ", "                      ", "                      ", "           F          ", "           F          ", "          CFC         ", "           F          ", "           F          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "          CCC         ", "                      ", "          DDD         ", "        CCDDDCC       ", "          DDD         ", "        DD   DD       ", "       CDDEEEDDC      ", "        DD   DD       ", "      DD       DD     ", "     CDDE  E  EDDC    ", "      DD       DD     ", "     D           D    ", "    CDE   EEE   EDC   ", "     D           D    ", "    D             D   ", "    D             D   ", "    D             D   ", "    DE  EEEEEEE  ED   ", "     DDDDDDDDDDDDD    ")
                    .aisle("        D     D       ", "        D     D       ", "        D     D       ", "        D  F  D       ", "        D FEF D       ", "        D F F D       ", "        DCFEFCD       ", "        D F F D       ", "        D FCF D       ", "        D  F  D       ", "        D  C  D       ", "        D  C  D       ", "        D  C  D       ", "        D  C  D       ", "        D  C  D       ", "        DDDDDDD       ", "        CCCCCCC       ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "          DDD         ", "         CDDDC        ", "          DDD         ", "        DD   DD       ", "       CDDEEEDDC      ", "        DD   DD       ", "       D       D      ", "      CDEE E EEDC     ", "       D       D      ", "      D         D     ", "     CDE  EEE  EDC    ", "      D         D     ", "     D           D    ", "    CDE  E E E  EDC   ", "     D           D    ", "    D             D   ", "    D             D   ", "    D             D   ", "    DE EE  E  EE ED   ", "     DDDDDDDDDDDDD    ")
                    .aisle("                      ", "                      ", "           F          ", "          F F         ", "         F E F        ", "         F   F        ", "        CF E FC       ", "         F   F        ", "         F C F        ", "          FFF         ", "                      ", "                      ", "                      ", "                      ", "                      ", "        D     D       ", "        C     C       ", "                      ", "                      ", "                      ", "          DDD         ", "          DDD         ", "          DDD         ", "         D   D        ", "        CDEEEDC       ", "         D   D        ", "        D     D       ", "       CDE E EDC      ", "        D     D       ", "      DD       DD     ", "     CDDE EEE EDDC    ", "      DD       DD     ", "     D           D    ", "    CDE  E E E  EDC   ", "     D           D    ", "    D             D   ", "   CDE  E EEE E  EDC  ", "    D             D   ", "   D               D  ", "   D               D  ", "   D               D  ", "   D E E  EEE  E E D  ", "    DDDDDLLLLLDDDDD   ")
                    .aisle("                      ", "           F          ", "          F F         ", "         FC CF        ", "        F CEC F       ", "        F C C F       ", "       CF CEC FC      ", "        F C C F       ", "        F CCC F       ", "         FFFFF        ", "           F          ", "           F          ", "           F          ", "           F          ", "           F          ", "        D  F  D       ", "        C  D  C       ", "          DDD         ", "          DDD         ", "          DDD         ", "         DDDDD        ", "         D   D        ", "         D E D        ", "        D     D       ", "       CDE E EDC      ", "        D     D       ", "       D       D      ", "      CDE  E  EDC     ", "       D       D      ", "      D         D     ", "     CDE E E E EDC    ", "      D         D     ", "     D           D    ", "    CDE E  E  E EDC   ", "     D           D    ", "    D             D   ", "   CDE E E E E E EDC  ", "    D             D   ", "   D               D  ", "   D               D  ", "   D               D  ", "   D E E E E E E E D  ", "    DDDDDLLLLLDDDDD   ")
                    .aisle("CC         G        CC", " CC       FEF       CC", "  CC     F E F     CC ", "   CC   F  E  F   CC  ", "   CCC FEEEEEEEF CCC  ", "   C CCF   E   FCC C  ", "   C  CFEEEEEEEFC  C  ", "   C   F   E   F   C  ", "   C   FCCCECCCF   C  ", "   C    FFFEFFF    C  ", "   C    C FEF C    C  ", "   C    C FEF C    C  ", "   C    C FEF C    C  ", "   C    C FEF C    C  ", "   C    C FEF C    C  ", "   C    D FEF D    C  ", "   C    C DED C    C  ", "   C      DED      C  ", "   C      DED      C  ", "   C      DED      C  ", "   C     DDEDD     C  ", "   C     D E D     C  ", "   C     DEEED     C  ", "   C    D  E  D    C  ", "   CCCCCDEEEEEDCCCCC  ", "   C    D  E  D    C  ", "   C   D   E   D   C  ", "   CCCCDEEEEEEEDCCCC  ", "   C   D   E   D   C  ", "   C  D    E    D  C  ", "   CCCDEEEEEEEEEDCCC  ", "   C  D    E    D  C  ", "   C D     E     D C  ", "   CCDEEEEEEEEEEEDCC  ", "   C D     E     D C  ", "   CD      E      DC  ", "   CDEEEEEEEEEEEEEDC  ", "   CD      E      DC  ", "   D       E       D  ", "   D       E       D  ", "   D       E       D  ", "   D EEEEEEEEEEEEE D  ", "    DDDDDLL~LLDDDDD   ")
                    .aisle("                      ", "           F          ", "          F F         ", "         FC CF        ", "        F CEC F       ", "        F C C F       ", "       CF CEC FC      ", "        F C C F       ", "        F CCC F       ", "         FFFFF        ", "           F          ", "           F          ", "           F          ", "           F          ", "           F          ", "        D  F  D       ", "        C  D  C       ", "          DDD         ", "          DDD         ", "          DDD         ", "         DDDDD        ", "         D   D        ", "         D E D        ", "        D     D       ", "       CDE E EDC      ", "        D     D       ", "       D       D      ", "      CDE  E  EDC     ", "       D       D      ", "      D         D     ", "     CDE E E E EDC    ", "      D         D     ", "     D           D    ", "    CDE E  E  E EDC   ", "     D           D    ", "    D             D   ", "   CDE E E E E E EDC  ", "    D             D   ", "   D               D  ", "   D               D  ", "   D               D  ", "   D E E E E E E E D  ", "    DDDDDLLLLLDDDDD   ")
                    .aisle("                      ", "                      ", "           F          ", "          F F         ", "         F E F        ", "         F   F        ", "        CF E FC       ", "         F   F        ", "         F C F        ", "          FFF         ", "                      ", "                      ", "                      ", "                      ", "                      ", "        D     D       ", "        C     C       ", "                      ", "                      ", "                      ", "          DDD         ", "          DDD         ", "          DDD         ", "         D   D        ", "        CDEEEDC       ", "         D   D        ", "        D     D       ", "       CDE E EDC      ", "        D     D       ", "      DD       DD     ", "     CDDE EEE EDDC    ", "      DD       DD     ", "     D           D    ", "    CDE  E E E  EDC   ", "     D           D    ", "    D             D   ", "   CDE  E EEE E  EDC  ", "    D             D   ", "   D               D  ", "   D               D  ", "   D               D  ", "   D E E  EEE  E E D  ", "    DDDDDLLLLLDDDDD   ")
                    .aisle("        D     D       ", "        D     D       ", "        D     D       ", "        D  F  D       ", "        D FEF D       ", "        D F F D       ", "        DCFEFCD       ", "        D F F D       ", "        D FCF D       ", "        D  F  D       ", "        D  C  D       ", "        D  C  D       ", "        D  C  D       ", "        D  C  D       ", "        D  C  D       ", "        DDDDDDD       ", "        CCCCCCC       ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "          DDD         ", "         CDDDC        ", "          DDD         ", "        DD   DD       ", "       CDDEEEDDC      ", "        DD   DD       ", "       D       D      ", "      CDEE E EEDC     ", "       D       D      ", "      D         D     ", "     CDE  EEE  EDC    ", "      D         D     ", "     D           D    ", "    CDE  E E E  EDC   ", "     D           D    ", "    D             D   ", "    D             D   ", "    D             D   ", "    DE EE  E  EE ED   ", "     DDDDDDDDDDDDD    ")
                    .aisle("                      ", "                      ", "                      ", "                      ", "           F          ", "           F          ", "          CFC         ", "           F          ", "           F          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "          CCC         ", "                      ", "          DDD         ", "        CCDDDCC       ", "          DDD         ", "        DD   DD       ", "       CDDEEEDDC      ", "        DD   DD       ", "      DD       DD     ", "     CDDE  E  EDDC    ", "      DD       DD     ", "     D           D    ", "    CDE   EEE   EDC   ", "     D           D    ", "    D             D   ", "    D             D   ", "    D             D   ", "    DE  EEEEEEE  ED   ", "     DDDDDDDDDDDDD    ")
                    .aisle("                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "                      ", "                      ", "          CCC         ", "                      ", "         DDDDD        ", "        CDDDDDC       ", "         DDDDD        ", "       DD     DD      ", "      CDDEEEEEDDC     ", "       DD     DD      ", "      D         D     ", "     CDEE  E  EEDC    ", "      D         D     ", "     D           D    ", "     D           D    ", "     D           D    ", "     DE    E    ED    ", "      DDDDDDDDDDD     ")
                    .aisle("                      ", "                      ", "                      ", "                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "                      ", "                      ", "           C          ", "                      ", "                      ", "         CCCCC        ", "                      ", "         DDDDD        ", "       CCDDDDDCC      ", "         DDDDD        ", "       DD     DD      ", "      CDDEEEEEDDC     ", "       DDDDDD DD      ", "      D         D     ", "      D         D     ", "      D         D     ", "      DEEEEEEEEED     ", "       DDDDDDDDD      ")
                    .aisle("                      ", "                      ", "                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "           C          ", "                      ", "                      ", "           C          ", "                      ", "                      ", "           C          ", "                      ", "                      ", "         CCCCC        ", "                      ", "         DDDDD        ", "       CCDDDDDCC      ", "         DDDDD        ", "       DDDDDD DD      ", "       DDDDDD DD      ", "       DDDDDD DD      ", "       DDDDDD DD      ", "         DDDDD        ")
                    .aisle("                      ", "                      ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "           C          ", "         CCCCC        ", "           C          ", "         DDDDD        ", "         DDDDD        ", "         DDDDD        ", "         DDDDD        ", "                      ")
                    .aisle("                      ", "           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ")
                    .aisle("           C          ", "           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ")
                    .aisle("           C          ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ", "                      ")
                    .where('~', Predicates.controller(blocks(definition.getBlock())))
                    .where(' ', Predicates.any())
                    .where("C", Predicates.blocks(Registries.getBlock("gtceu:stainless_steel_frame")))
                    .where("D", Predicates.blocks(Registries.getBlock("gtceu:stable_machine_casing")))
                    .where("L", Predicates.blocks(Registries.getBlock("gtceu:stable_machine_casing"))
                            .setMinGlobalLimited(10)
                            .or(Predicates.abilities(PartAbility.EXPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.IMPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.EXPORT_FLUIDS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.IMPORT_FLUIDS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(Predicates.abilities(PartAbility.INPUT_ENERGY).setMaxGlobalLimited(2)))
                    .where("E", Predicates.blocks(Registries.getBlock("gtceu:ptfe_pipe_casing")))
                    .where("F", Predicates.blocks(Registries.getBlock("gtceu:ev_machine_casing")))
                    .where("G", Predicates.blocks(Registries.getBlock("ialdgtcore:void_world_block")))
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_stable_titanium"),
             GTCEu.id("block/multiblock/cleanroom"), false)
            .tooltips(Component.translatable("block.ialdgtcore.large_shape_world_void_pump.tooltip"))
            .register();

    public static final MachineDefinition Compressed_Block_Transmutation_Chamber = REGISTRATE.multiblock("compressed_block_transmutation_chamber",  WorkableElectricMultiblockMachine::new)
            .rotationState(RotationState.NON_Y_AXIS)
            .appearanceBlock(() -> Registries.getBlock("gtlcore:aluminium_bronze_casing"))
            .recipeType(SARecipes.Compressed_Block_Transmutation_Chamber)
            .recipeModifiers(GTRecipeModifiers.PARALLEL_HATCH, GTRecipeModifiers.ELECTRIC_OVERCLOCK.apply(OverclockingLogic.PERFECT_OVERCLOCK_SUBTICK))
            .pattern(definition -> FactoryBlockPattern.start()
                    .aisle("AAAAA", "AAAAA", "BBBBB", "BBBBB", "AAAAA", "AAAAA")
                    .aisle("AAAAA", "ACCCA", "B   B", "B   B", "ACCCA", "AAAAA")
                    .aisle("AAAAA", "ACCCA", "B A B", "B A B", "ACCCA", "AA~AA")
                    .aisle("AAAAA", "ACCCA", "B   B", "B   B", "ACCCA", "AAAAA")
                    .aisle("AAAAA", "AAAAA", "BBBBB", "BBBBB", "AAAAA", "AAAAA")
                    .where("~", Predicates.controller(Predicates.blocks(definition.get())))
                    .where("A", Predicates.blocks(Registries.getBlock("gtlcore:aluminium_bronze_casing"))
                            .setMinGlobalLimited(10)
                            .or(Predicates.abilities(PartAbility.EXPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.IMPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(Predicates.abilities(PartAbility.INPUT_ENERGY).setMaxGlobalLimited(2)))
                    .where("C", Predicates.blocks(Registries.getBlock("kubejs:shining_obsidian")))
                    .where("B", Predicates.blocks(Registries.getBlock("gtceu:tempered_glass")))
                    .build())
            .workableCasingRenderer(ialdgtcore.id("block/casings/aluminium_bronze_casing"),
                    GTCEu.id("block/multiblock/cleanroom"), false)
            .tooltips(Component.translatable("block.ialdgtcore.compressed_block_transmutation_chamber.tooltip"))
            .register();

    public static final MachineDefinition THERMOMAGNETIC_COOLING_GENERATOR = REGISTRATE.multiblock("thermomagnetic_cooling_generator",  WorkableElectricMultiblockMachine::new)
            .rotationState(RotationState.NON_Y_AXIS)
            .appearanceBlock(() -> Registries.getBlock("gtceu:lv_machine_casing"))
            .recipeType(SARecipes.THERMOMAGNETIC_COOLING_GENERATOR)
            .recipeModifiers(GTRecipeModifiers.PARALLEL_HATCH, GTRecipeModifiers.ELECTRIC_OVERCLOCK.apply(OverclockingLogic.PERFECT_OVERCLOCK_SUBTICK))
            .pattern(definition -> FactoryBlockPattern.start()
                    .aisle("     ", " AAA ", " ABA ", " AAA ", "     ", "     ", "     ")
                    .aisle(" AAA ", "A D A", "ACECA", "A D A", " AAA ", "     ", "     ")
                    .aisle(" AAA ", "A D A", "ACECA", "A D A", " AAA ", "     ", "     ")
                    .aisle(" AAA ", "A D A", "ACECA", "A D A", " ABA ", "  B  ", "  B  ")
                    .aisle(" AAA ", "A D A", "ACECA", "A D A", " AAA ", "     ", "  B  ")
                    .aisle(" AAA ", "A D A", "ACECA", "A D A", " AAA ", "     ", "  B  ")
                    .aisle("     ", " AAA ", " ABA ", " AAA ", "     ", "     ", "  B  ")
                    .aisle("     ", " BBB ", " B~B ", " BBB ", "  B  ", "  B  ", "  B  ")
                    .where("~", Predicates.controller(Predicates.blocks(definition.get())))
                    .where("B", Predicates.blocks(Registries.getBlock("gtceu:lv_machine_casing"))
                            .setMinGlobalLimited(10)
                            .or(Predicates.abilities(PartAbility.IMPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(Predicates.abilities(PartAbility.OUTPUT_ENERGY).setMaxGlobalLimited(2)))
                    .where("E", Predicates.blocks(Registries.getBlock("minecraft:redstone_block")))
                    .where("D", Predicates.blocks(Registries.getBlock("minecraft:blue_ice")))
                    .where("A", Predicates.blocks(Registries.getBlock("minecraft:iron_block")))
                    .where("C", Predicates.blocks(Registries.getBlock("minecraft:magma_block")))
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/voltage/lv/side"),
                    GTCEu.id("block/multiblock/fusion_reactor"), false)
            .tooltips(Component.translatable("block.ialdgtcore.thermomagnetic_cooling_generator.tooltip"))
            .register();

    public static final MachineDefinition GENERAL_ENERGY_FURNACE = REGISTRATE.multiblock("general_energy_furnace",  WorkableElectricMultiblockMachine::new)
            .rotationState(RotationState.NON_Y_AXIS)
            .appearanceBlock(CASING_HIGH_TEMPERATURE_SMELTING)
            .recipeType(GTRecipeTypes.BLAST_RECIPES)
            .recipeType(GCyMRecipeTypes.ALLOY_BLAST_RECIPES)
            .recipeModifiers(GTRecipeModifiers.PARALLEL_HATCH, GTRecipeModifiers.ELECTRIC_OVERCLOCK.apply(OverclockingLogic.PERFECT_OVERCLOCK_SUBTICK))
            .recipeModifier((machine, recipe, params, result) -> {
                GTRecipe recipe1 = recipe.copy();
                recipe1.duration = 0;
                recipe1 = GTRecipeModifiers.fastParallel(machine, recipe1, 2147483647, false).getFirst();
                return recipe1;
            })
            .pattern(definition -> FactoryBlockPattern.start()
                    .aisle("aaaaaaa", "ccccccc", "ccccccc", "ccccccc", "eeeeeee", "ccccccc", "ccccccc", "ccccccc", "aaaaaaa")
                    .aisle("aaaaaaa", "c     c", "c     c", "c     c", "e     e", "c     c", "c     c", "c     c", "aaaaaaa")
                    .aisle("aaaaaaa", "c     c", "c     c", "c     c", "e     e", "c     c", "c     c", "c     c", "aaaaaaa")
                    .aisle("aaaaaaa", "c     c", "c     c", "c     c", "e  f  e", "c     c", "c     c", "c     c", "aaaaaaa")
                    .aisle("aaaaaaa", "c     c", "c     c", "c     c", "e     e", "c     c", "c     c", "c     c", "aaaaaaa")
                    .aisle("aaaaaaa", "c     c", "c     c", "c     c", "e     e", "c     c", "c     c", "c     c", "aaaaaaa")
                    .aisle("aaa~aaa", "ccccccc", "ccccccc", "ccccccc", "eeeeeee", "ccccccc", "ccccccc", "ccccccc", "aaaaaaa")
                    .where('~', Predicates.controller(blocks(definition.getBlock())))
                    .where(' ', Predicates.any())
                    .where("c", Predicates.blocks(Registries.getBlock("gtceu:cleanroom_glass")))
                    .where("a", Predicates.blocks(Registries.getBlock("gtceu:high_temperature_smelting_casing"))
                            .setMinGlobalLimited(10)
                            .or(Predicates.abilities(PartAbility.EXPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.IMPORT_ITEMS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.EXPORT_FLUIDS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.IMPORT_FLUIDS).setPreviewCount(1))
                            .or(Predicates.abilities(PartAbility.INPUT_LASER).setMaxGlobalLimited(1))
                            .or(Predicates.abilities(PartAbility.INPUT_ENERGY).setMaxGlobalLimited(2)))
                    .where("e", Predicates.blocks(Registries.getBlock("gtceu:heat_vent")))
                    .where("f", Predicates.heatingCoils())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/gcym/high_temperature_smelting_casing"),
            GTCEu.id("block/multiblock/fusion_reactor"), false)
            .tooltips(Component.translatable("block.ialdgtcore.general_energy_furnace.tooltip"))
            .register();
}
